language: rust
rust:
    - stable
    - beta
    - nightly
sudo: false
dist: trusty
os: linux
cache:
    directories:
        - $HOME/.cargo
        - target
env:
    global:
        - secure: "NrPAnuJOqlJwus3L4LyE2Q73loLkhw63l0g6P5si7rr72V/4CtEs2lc5TAVA0LgX94hO95a6h1Z+WqSYp894brCWlqkvOJY9nzy2iVEDxUO+xV+lnSnYLSXPt3oYMzCkMRBX+aU8ugmTiKyAUgljlhvVthHtRHB0OXMy4pkCU9wcyfGDWKnBnlReI/dJQM2mdnsc92Tsacl16IcbEpb5FwCb041ZzMCH/VBn6gC/qBqXkab82IN/yBUd2BjN4+UlDOr9+2OLLmK9cgVu8CIvE+L13eCLoOd0WeXFiEapZtr6o2SN2/KtXZK0iROpo48ZY/lRz5538SNIo+PkQKp4bEZcax8L1gulBiOvbx7NsD9CBqcO/97gVdaUOK3mJSB5GCkr2QHaqUx/ACASPNmqTjfVQQyWKMBkXakzUVNiibxamZo4e/xQ6pgypb3cbSHLvSUu5CB+KraDBfKNZvyE6FbW99ZL4bRco3y9bfW3Jq6sHNyagBSxa1NtS9cLNiqvh2umy/PCMczOIOnu+k6coBRvcxFCMs1/BftuCQvkoeSbicTKe8eCCfSng3KljMIALfQK1O1+dT0QOD1HJHiRBulyioD9GwSmqkopOKvQbOfDv5m4lvQq5X5Np1RerOj9rqEkGuMRzkpyIXjMFrOgOYfh0YBMGB4XoCss30Cy0es="
        - secure: "FcsYL3ETIDEOX41etvJfhkSOKHTNbh7iEtr3SvCIFcAvzPISV7NjUptdmcNvbB7RxnZMunjnAac+Aan9imFsxZn8VrVAQ0I3TxBXmT0gUSs5F1b6L8Ca1F/yTb5BwGKBEX6ZfOW0ww1/EBAoO0lVq/CWBRJTytycJR/Znyax583FRZA50sEKK3Kdxc2HTvAG2ok3o+c7owfMSEvDV/lTEjPdKKe4uu2mk8H4Dhc8fwrqf+i53Q9PFl2LXM2fwSsbzqTSy75YKjEB+0SfFOwHn8o9vRoCvj3emgTsImnls/PG+j6LivhosNy9ZOUnY9jWDR+GpbQhO2ry9D/SkyHQ10DbcIBbIFxPzfthNyX4RgKwplrtetAq35cg9euXzDG5+KU2oAdpRhS57eYwNqV+OSeD3TzoO76shCOJEmxjef/C4mynzaZ5QnPbOE51E3+52J/R8Eacz1XzgxvF2X5qeq+IMoiXLBWFB6OjOaieaMIk9NFX3BA6s8KaGYi9C0e2UeYcAPiGbppOmEKwBcIRNWWYwObxnFI6GcPRaMV/8fJN6UEsmXGVhNZgs+b2mv8p4LuUbOFzqVuMeBK9PjT5qih5BerRwNzj6D2UiJA2rD+vB6SQ0DM893wyzJO9A1Ns4Okx3mDfZJ4P7AfSTAyvfYHptSXDca6ZVDIGnCxRxcw="
    matrix:
        - CARGO_FEATURES=
        - CARGO_FEATURES=smallvec
before_script:
    - curl -L https://github.com/arcnmx/ci/archive/master.tar.gz | tar -xzC $HOME && . $HOME/ci-master/src

script:
    - cargo build
    - cargo test
    - cargo test --release

deploy:
    provider: script
    script: "true"
    on:
        tags: true
        all_branches: true
        condition: "$TRAVIS_RUST_VERSION = stable && -z $CARGO_FEATURES"

before_deploy:
    - cargo doc
    - cargo package

after_deploy:
    - cargo pages-publish
    - cargo publish
